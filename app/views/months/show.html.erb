<%= render partial: "layouts/header" %>
<div class="main">
  <%= render partial: "layouts/side-bar" %>
  <div class="contents">
    <div class="calendar">
      <div class="calendar-heading">
        <% if @month == 1 %>
          <%= link_to '◀︎', year_month_path(@year - 1, 12), class: "last-month-btn" %>
        <% else %>
          <%= link_to '◀︎', year_month_path(@year, @month - 1), class: "last-month-btn" %>
        <% end %>
        <p id="display-year"><%= @year %></p>年 <p id="display-month"><%= @month %></p>月
        <span id="wday_num"><%= Date.new(@year, @month, 1).wday %></span>
        <% if @month == 12 %>
          <%= link_to '▶︎', year_month_path(@year + 1, 1), class: "next-month-btn" %>
        <% else %>
          <%= link_to '▶︎', year_month_path(@year, @month + 1), class: "next-month-btn" %>
        <% end %>
      </div>
      <div class="spend-sum" id="month-sum">
        合計出費額：<%= @sum %>円
      </div>
      <div class="show-list">
        <div class="show-day">
          支出一覧
        </div>
        <% Date.new(@year, @month, 1).end_of_month.day.times do |i| %>
          <% if @each_day_spends[i].length != 0 %>
            <div class="show-box">
              <% @each_day_spends[i].each do |spend| %>
                <div class="show-info">
                  <div class="show-date">
                    <%= spend.day.to_s %>
                  </div>
                  <div class="category-mark">
                    <%= spend.category_id %>
                  </div>
                  <div class="show-spend">
                    <%= spend.money %>円
                  </div>
                  <div class="show-memo">
                    <%= spend.memo %>
                  </div>
                  <div class="show-id" style="display: none;">
                    <%= spend.id %>
                  </div>
                </div>
              <% end %>
            </div>
          <% end %>
        <% end %>
      </div>
    </div>
    <div class="spend-input">
      <div class="spend-form-text">支出を編集</div>
      <%= form_with url: "/years/#{@year}/months/#{@month}/spends", class: "spend-input-form", id: "form" do |f| %>
        <%= f.text_field :index %>
        <%= f.text_field :update_id %>
        <div class="day-form">
          <%= raw sprintf(
                    f.date_select(
                      :day,
                      use_month_numbers: true,
                      default: Date.today,
                      start_year: (Date.today.year - 50),
                      end_year: (Date.today.year + 10),
                      date_separator: '%s'),
                    "<p class='year'> 年 </p>", "<p class='month'> 月 </p>") + "<p class='day'> 日 </p>" %>
        </div>
        <%= f.text_field :money, class: "spend-money-input-form", placeholder: "支出金額を入力してください。" %>
        <%= f.collection_select(
          :category_id,
          @select_categories,
          :id, 
          :title, 
          {}, 
          {class: "spend-category-select"}) %>
        <%= f.text_area :memo, class: "spend-memo-form", row: "10" %>
        <div id="spend-show-btns" style="display: none;">
          <%= f.submit "支出を編集する", id: "spend-update-submit" %>
          <div id="delete-btn">支出を削除する</div>
        </div>
      <% end %>
    </div>
  </div>

  <div style="display: none">
    <% @select_categories.each do |category| %>
      <% if category.id != 0%>
        <span class="color-id"><%= category.color_id %></span>
        <span class="category-name"><%= category.title %></span>
      <% end %>
    <% end %>
  </div>

  <div id="color-list" style="display: none;">
    <% @colors.each do |color| %>
      <div class="color">(<%= color.rgb[0] %>, <%= color.rgb[1] %>, <%= color.rgb[2] %>)</div>
    <% end %>
  </div>
</div>